# ConsultingG Real Estate - Production Apache Configuration
# For superhosting.bg deployment at /home/yogahon/consultingg.com

RewriteEngine On

# Force HTTPS and canonical domain
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} ^www\.consultingg\.com$ [NC]
RewriteRule ^(.*)$ https://consultingg.com/$1 [R=301,L]

# Security Headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# Cache headers for assets
<FilesMatch "\.(css|js|woff2?|ttf|eot|ico|png|jpg|jpeg|gif|webp|svg)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header unset ETag
    FileETag None
</FilesMatch>

# No cache for API
<LocationMatch "^/api">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
</LocationMatch>

# API routing - route /api requests to api/index.php
RewriteRule ^api/?$ api/index.php [L,QSA]
RewriteRule ^api/(.*)$ api/index.php [L,QSA]

# Handle preflight requests for API
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^api/(.*)$ api/index.php [L]

# Protect sensitive files
<FilesMatch "\.(env|ini|sql|md|json|lock|log)$">
    Require all denied
</FilesMatch>

# Prevent directory browsing
Options -Indexes

# SPA fallback - all non-file requests go to index.html (except /api and /uploads)
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/uploads/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]